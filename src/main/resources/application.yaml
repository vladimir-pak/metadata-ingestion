# application.yml

spring:
  application:
    name: metadata-ingestion
    version: 0.0.1-SNAPSHOT
    dpt: 912044
    dntdom: GPB
    user: test_user
    ip: test_ip
    host: test_dns
    port: test_port

  datasource:
    url: ${DB_URL:jdbc:postgresql://localhost:5432/meta_base}
    username: ${DB_USER:postgres}
    password: ${DB_PASSWORD:kampus}
    driverClassName: org.postgresql.Driver
    # driverClassName: org.apache.ignite.IgniteJdbcThinDriver
    hikari:
      maximum-pool-size: 20
      connection-timeout: 30000
      idle-timeout: 600000
      max-lifetime: 1800000
      pool-name: TargetDBPool

  jpa:
    hibernate:
      ddl-auto: none
    show-sql: true
    properties:
      hibernate:
        default_schema: postgres_metadata
        dialect: org.hibernate.dialect.PostgreSQLDialect
        jdbc:
          lob:
            non_contextual_creation: true
        temp:
          use_jdbc_metadata_defaults: false

  flyway:
    schemas: postgres_metadata
    enabled: true
    locations: classpath:db/migration
    url: jdbc:postgresql://localhost:5432/meta_base
    user: postgres
    password: kampus

  tomcat:
    max-connections: 100 # Максимальное количество соединений
    accept-count: 100 # Максимальное количество потоков
    threads:
      max: 50 # Размер очереди запросов

ignite:
  persistence:
    storagePath: ./ignite/storage
    walPath: ./ignite/wal
    walArchivePath: ./ignite/wal-archive
    
ord:
  api:
    baseUrl: http://localhost:8585/api/v1
    endpoints:
      database: /databases
      schema: /databaseSchemas
      table: /tables
    max-connections: 10 # Количество параллельно выполняемых api в ОРД

keycloak:
  server-url: https://auth.example.com/realms/myrealm/protocol/openid-connect/token
  client-id: my-client
  client-secret: my-secret # Опционально
  username: service-user
  password: service-pass

jwt:
  token: eyJraWQiOiJHYjM4OWEtOWY3Ni1nZGpzLWE5MmotMDI0MmJrOTQzNTYiLCJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJvcGVuLW1ldGFkYXRhLm9yZyIsInN1YiI6ImFkbWluIiwiZW1haWwiOiJhZG1pbkBvcGVubWV0YWRhdGEub3JnIiwiaXNCb3QiOmZhbHNlLCJ0b2tlblR5cGUiOiJQRVJTT05BTF9BQ0NFU1MiLCJpYXQiOjE3NjA0Mzk3MDQsImV4cCI6bnVsbH0.on5MXkOV22bRcrK0KUiT9LqQQIc463BjTOXiz64UJyCJxoWMhd9KMu6r9w_8knHS7Zmf6HVuJw_VqYA1yXL2wOXZyF8bDutFd0YlQbhLZKxsh2aJ6bI8kxiEWbmhixESoEVQJ4Qa3lzBPY6SFsJdnS7N1rD8Kr13pM2szTnGcX98-ggO0gQFja4LecsHMBNCyFFuIZVIoHlyPA_-JirdxPxMIhmHGHbPXRAPI0gzsWXRIDx0lOhBsPbtXw6vnL0DYSa0NzYRgCMT9ouHhWuP6gbUXF-IFgPvAu_47qnWBldC9g9v7VW-YgbG7FiD1OPlMFgVtWtL7mL-wZrkA_54mA

logs-database:
  enabled: true
  task-create-partition: 0 0 0 * * ?
  url: jdbc:postgresql://localhost:5432/db_log
  username: postgres
  password: kampus
  driverClassName: org.postgresql.Driver
  table: "audit.jdata_orda_sync_log"

clean-database-logs:
  # cron expression, to switch off put value '-'
  task-cleaner-schedule: 0 0 1 * * ?
  # delete logs from db that older than X years
  clean-period: 3


management:
  endpoints:
    web:
      exposure:
        include: health,metrics,info
    endpoint:
      health:
        show-details: always
    metrics:
      export:
        prometheus:
          enabled: true

logging:
  cef:
    path: logs/cef
    retention-days: 30
  level:
    root: INFO
    org.hibernate.SQL: DEBUG
    org.hibernate.engine.jdbc.connections.internal.DriverManagerConnectionProviderImpl: DEBUG
    org.apache.flink: INFO
    org.springframework.jdbc: WARN
    com.gpb.metadata.ingestion: DEBUG
  file:
    name: logs/metadata-ingestion.log
  pattern:
    file: "%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n"
    console: "%d{HH:mm:ss} %-5level %logger{36} - %msg%n"
  logback:
    rollingpolicy:
      max-file-size: 50MB
      max-history: 7

metadata:
  schemas:
    postgres: postgres_metadata
    mssql: mssql_metadata
    oracle: oracle_metadata